status_led:
  pin:
    number: D0
    inverted: true

external_components:
  - source: github://gabe565/esphome-configs@master
    components: [uplift_desk]

uart:
  tx_pin: $tx_pin
  rx_pin: $rx_pin
  baud_rate: 9600

uplift_desk:
  id: desk

sensor:
  - platform: uplift_desk
    height:
      name: $device_name Height
      id: height_sensor
    state:
      id: state_sensor

switch:
  # Up
  - platform: template
    name: $device_name Up
    id: move_up_switch
    optimistic: true
    icon: mdi:arrow-up
    turn_on_action:
      - switch.turn_off: move_down_switch
      - while:
          condition:
            lambda: "return true;"
          then:
            - lambda: id(desk).send_cmd_up();
            - delay: 1s
    turn_off_action:
      if:
        condition:
          switch.is_off: move_down_switch
        then:
          lambda: id(desk).send_cmd_stop();

  # Down
  - platform: template
    name: $device_name Down
    id: move_down_switch
    optimistic: true
    icon: mdi:arrow-down
    turn_on_action:
      - switch.turn_off: move_up_switch
      - while:
          condition:
            lambda: "return true;"
          then:
            - lambda: id(desk).send_cmd_down();
            - delay: 1s
    turn_off_action:
      if:
        condition:
          switch.is_off: move_up_switch
        then:
          lambda: id(desk).send_cmd_stop();

button:
  # Save Preset 1
  - platform: template
    name: $device_name Save Preset 1
    icon: mdi:floppy
    on_press:
      lambda: id(desk).send_cmd_save_preset_1();

  # Save Preset 2
  - platform: template
    name: $device_name Save Preset 2
    icon: mdi:floppy
    on_press:
      lambda: id(desk).send_cmd_save_preset_2();

  # Save Preset 3
  - platform: template
    name: $device_name Save Preset 3
    icon: mdi:floppy
    on_press:
      lambda: id(desk).send_cmd_save_preset_3();

  # Save Preset 4
  - platform: template
    name: $device_name Save Preset 4
    icon: mdi:floppy
    on_press:
      lambda: id(desk).send_cmd_save_preset_4();

  # Preset 1
  - platform: template
    name: $device_name Preset 1
    icon: mdi:numeric-1-box
    on_press:
      lambda: id(desk).send_cmd_preset_1();

  # Preset 2
  - platform: template
    name: $device_name Preset 2
    icon: mdi:numeric-2-box
    on_press:
      lambda: id(desk).send_cmd_preset_2();

  # Preset 3
  - platform: template
    name: $device_name Preset 3
    icon: mdi:numeric-3-box
    on_press:
      lambda: id(desk).send_cmd_preset_3();

  # Preset 4
  - platform: template
    name: $device_name Preset 4
    icon: mdi:numeric-4-box
    on_press:
      lambda: id(desk).send_cmd_preset_4();

  # Manual Sync
  - platform: template
    name: $device_name Sync
    icon: mdi:sync
    on_press:
      lambda: id(desk).send_cmd_sync();
